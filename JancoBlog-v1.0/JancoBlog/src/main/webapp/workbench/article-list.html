<!DOCTYPE html>
<html class="x-admin-sm">
    <head>
        <meta charset="UTF-8">
        <title>文章列表</title>
        <meta name="renderer" content="webkit">
        <meta content="IE=edge,chrome=1;" http-equiv="X-UA-Compatible">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="./css/font.css">
        <link rel="stylesheet" href="./css/xadmin.css">
        <script src="./lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="./js/xadmin.js"></script>
    </head>
    
    <body>
        <div class="x-nav">
            <span class="layui-breadcrumb">
                <a href="">首页</a>
                <a href="">演示</a>
                <a>
                    <cite>导航元素</cite></a>
            </span>
            <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
                <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
            </a>
        </div>
        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">
                            <form class="layui-form layui-col-space5">
                                <div class="layui-input-inline layui-show-xs-block">
                                    <input class="layui-input" placeholder="开始日" name="start" id="start"></div>
                                <div class="layui-input-inline layui-show-xs-block">
                                    <input class="layui-input" placeholder="截止日" name="end" id="end"></div>
                            </form>
                        </div>
                        <div class="layui-card-header">
                            <button class="layui-btn layui-btn-danger" onclick="delAll()">
                                <i class="layui-icon"></i>批量删除</button>
                            <button class="layui-btn" onclick="xadmin.open('添加用户','./order-add.html',800,600)">
                                <i class="layui-icon"></i>添加</button></div>

                        <!-- 表格主体 -->
                        <div class="layui-card-body ">
                            <table id="article-table" lay-filter="article-table"
                                   class="layui-table layui-form"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/html" id="toolBar">
            <a class="layui-btn layui-btn-xs" lay-event="edit-article">编辑</a>
            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del-article">删除</a>
        </script>

    </body>
    <script>

        var currentPage = 1;
        var totalPage = 1;

        layui.use(['laydate', 'form', 'table'],
        function() {
            var laydate = layui.laydate;
            var table = layui.table;

            //执行一个laydate实例
            laydate.render({
                elem: '#start' //指定元素
            });

            //执行一个laydate实例
            laydate.render({
                elem: '#end' //指定元素
            });

            table.on('tool(article-table)', function(obj){
                var data = obj.data;
                console.log(data);
                if(obj.event === 'edit-article'){
                    $.ajax({
                        url: "../redirect/article",
                        type: "POST",
                        data: "id=" + data.articleId,
                        success : function (){
                            window.location.href = "../edit.jsp";
                        }
                    });
                } else if(obj.event === 'del-article'){
                    layer.confirm('真的要删除 ' + data.articleTitle +' 么', function() {
                        // 已经获得到了data，点击了确认，下一步是执行删除
                        var $ = layui.$;
                        $.ajax({
                            url: "../article/" + data.articleId,
                            type: "DELETE",
                            success: function (result){
                                if (result.extend.success){
                                    layer.msg("删除成功");
                                } else {
                                    layer.msg("删除失败，请稍后再试");
                                }
                            }
                        });
                        table.reload('article-table', {
                            url: '../articles/10000'
                        });
                    })
                }
            });

            $('.layui-btn').on('click', function(){
                var type = $(this).data('type');
                active[type] ? active[type].call(this) : '';
            });

            // 表格初始化渲染
            table.render({
                elem: '#article-table' // 挂载点
                ,id: 'article-table' // 表格id
                // ,height: 580 // 表格高度
                // 这里需要传用户的id，目前还不能做到动态获取id，先传一个默认的试试
                ,url: '../articles/10000' //数据接口
                ,toolbar: '#toolbar' //开启头部工具栏，并为其绑定左侧模板
                ,skin: 'line' //行边框风格
                ,even: true //开启隔行背景
                // ,height: 'full-200' // 页面的最大高度 - 100 （自适应）
                ,defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
                    title: '提示'
                    ,layEvent: 'LAYTABLE_TIPS'
                    ,icon: 'layui-icon-tips'
                }]
                ,parseData: function(res){ // 数据源
                    var articles = res.extend.pageInfo;
                    //res 即为原始返回的数据
                    return {
                        "code": "0", //解析接口状态
                        "msg": "", //解析提示文本
                        "count": articles.total, //解析数据长度
                        "data": articles.list //解析数据列表
                    };
                }
                ,page: { // 分页
                    groups: 5 //显示 10 个连续页码
                }
                ,cols: [[ //表头
                    {type:'checkbox'}
                    ,{field: 'articleTitle', title: '文章标题', width:280, sort: true}
                    ,{field: 'articlePostDate', title: '发布时间', width: 100, sort: true}
                    ,{field: 'articleEditTime', title: '修改时间', width: 150}
                    ,{field: 'articleViewTime', title: '浏览量', width: 120}
                    ,{field: 'articleLikeCount', title: '点赞', width: 120}
                    ,{field: 'articleCommentCount', title: '评论', width: 120}
                    ,{fixed: 'right', title:'操作', toolbar: '#toolBar', width:170}
                ]]
            });



           
        });



    </script>
</html>