<!DOCTYPE html><html><head><meta charset="utf-8"><title>HDFS体系结构</title>    <link rel="stylesheet" href="../js/editor.md/css/editormd.min.css">   <script src="../js/jquery-1.12.js" type="text/javascript" charset="utf-8"></script>
   <script src="../js/article-preload.js" type="text/javascript" charset="utf-8"></script>
<link rel="stylesheet" href="../css/article.css"></head><body><!-- 导航条 --><div class="nav">    <!-- 回主页的"图标" -->    <a href="../../index.jsp" class="back-to-index">JancoBlog</a></div><!-- 所属分类 --><div class="article-sort"></div><!-- 标题栏 --><h1 class="article-title">HDFS体系结构</h1><!-- 作者栏 --><div class="article-info"><div class="article-author">作者：Jancoyan</div><div class="article-submit-time">发布时间：2021-05-06 21:59:41</div><div class="article-view-time"></div></div><div class="article-content"><div class="markdown-body editormd-preview-container" previewcontainer="true" style="padding: 20px;"><h2 id="h2-u7B80u4ECB"><a name="简介" class="reference-link"></a><span class="header-link octicon octicon-link"></span>简介</h2><p>目前采用的计算机集群都是<strong>由普通硬件构成</strong>的，降低了硬件上的开销</p>
<p><img src="http://39.103.184.190:8888/JancoBlog/static/image/2021-05/20210506-21574410000.png" alt=""></p>
<p>windows和linux把磁盘化为512字节一组，是文件系统读写操作的最小单位，block是磁盘块的整数倍。</p>
<p>HDFS块默认位64MB，如果小于这个大小，只占用实际大小的空间。</p>
<p><img src="http://39.103.184.190:8888/JancoBlog/static/image/2021-05/20210506-21575210000.png" alt=""></p>
<p>优点：</p>
<ul>
<li>兼容、链家的硬件设备</li><li>流数据的读写</li><li>大数据集</li><li>简单的文件模型</li><li>强大的跨平台兼容性</li></ul>
<p>缺点</p>
<ul>
<li>不适合低延迟数据访问</li><li>无法高效存储大量小文件</li><li>不支持多用户写入和任意修改文件</li></ul>
<h2 id="h2-u76F8u5173u6982u5FF5"><a name="相关概念" class="reference-link"></a><span class="header-link octicon octicon-link"></span>相关概念</h2><h3 id="h3-u5757"><a name="块" class="reference-link"></a><span class="header-link octicon octicon-link"></span>块</h3><p>默认64MB，远大于普通文件系统 -&gt; 最小化寻址开销</p>
<p>块的好处：</p>
<ul>
<li>支持大规模文件存储：文件以块为单位进行存储，一个大规模文件可以被分拆成若干个文件块，不同的文件块可以被分发到不同的节点上，因此，一个文件的大小不会受到单个节点的存储容量的限制，可以远远大于网络中任意节点的存储容量</li><li>简化系统设计：首先，简化了存储管理，因为文件块大小是固定的，这样就可以很容易计算出一个节点可以存储多少文件块；其次，方便了元数据的管理，元数据不需要和文件块一起存储，可以由其他系统负责管理元数据</li><li>适合数据备份：每个文件块都可以冗余存储到多个节点上，大大提高了系统的容错性和可用性。</li></ul>
<h3 id="h3-u540Du79F0u8282u70B9u548Cu6570u636Eu8282u70B9"><a name="名称节点和数据节点" class="reference-link"></a><span class="header-link octicon octicon-link"></span>名称节点和数据节点</h3><p><img src="http://39.103.184.190:8888/JancoBlog/static/image/2021-05/20210506-21580110000.png" alt=""></p>
<p><img src="http://39.103.184.190:8888/JancoBlog/static/image/2021-05/20210506-21581110000.png" alt=""></p>
<p><img src="http://39.103.184.190:8888/JancoBlog/static/image/2021-05/20210506-21582710000.png" alt=""></p>
<p>解决名称节点运行期间EditLog不断变大的问题：</p>
<p>使用SecondaryNameNode第二名称节点（：用来保存名称节点中对HDFS元数据信息的备份，并减少名称节点重启的时间，一般单独运行在一台机器上）</p>
<p><img src="http://39.103.184.190:8888/JancoBlog/static/image/2021-05/20210506-21585610000.png" alt=""></p>
<p><img src="http://39.103.184.190:8888/JancoBlog/static/image/2021-05/20210506-21590310000.png" alt=""></p>
<h2 id="h2-hdfs-"><a name="HDFS体系结构" class="reference-link"></a><span class="header-link octicon octicon-link"></span>HDFS体系结构</h2><h3 id="h3-u4F53u7CFBu7ED3u6784u6982u8FF0"><a name="体系结构概述" class="reference-link"></a><span class="header-link octicon octicon-link"></span>体系结构概述</h3><p>HDFS采用了主从（Master/Slave）结构模型，一个HDFS集群包括一个名称节点NameNode和若干个数据节点DataNode。</p>
<p>名称节点作为中心服务器，负责管理文件系统的命名空间及客户端对文件的访问。</p>
<p>集群中的数据节点一般是一个节点运行一个数据节点进程，负责处理文件系统客户端的读写请求，在名称节点的统一调度下进行数据块的创建、删除和复制等操作。</p>
<p>每个数据节点的数据保存在本地linux文件系统中。</p>
<h3 id="h3-u547Du540Du7A7Au95F4u7BA1u7406"><a name="命名空间管理" class="reference-link"></a><span class="header-link octicon octicon-link"></span>命名空间管理</h3><p>HDFS的命名空间包含目录、文件和块。</p>
<p>在HDFS1.0体系结构中，在<strong>整个HDFS集群中只有一个命名空间</strong>，并且只有<strong>唯一一个名称节点</strong>，该节点负责对这个命名空间进行管理。</p>
<p>HDFS使用的是传统的分级文件体系，因此，用户可以像使用普通文件系统一样，创建、删除目录和文件，在目录间转移文件，重命名文件等。</p>
<h3 id="h3-u901Au4FE1u534Fu8BAE"><a name="通信协议" class="reference-link"></a><span class="header-link octicon octicon-link"></span>通信协议</h3><p>HDFS是一个部署在集群上的分布式文件系统，因此，很多数据需要通过网络进行传输。</p>
<p>所有的HDFS通信协议都是<strong>构建在TCP/IP协议基础之上</strong>的。客户端通过一个可配置的端口向名称节点主动发起TCP连接，并使用客户端协议与名称节点进行交互。</p>
<p>名称节点和数据节点之间则使用数据节点协议进行交互。客户端与数据节点的交互是通过RPC来实现的。在设计上，<strong>名称节点不会主动发起RPC</strong>，而是<strong>响应</strong>来自客户端和数据节点的RPC请求。</p>
<h3 id="h3-u5BA2u6237u7AEF"><a name="客户端" class="reference-link"></a><span class="header-link octicon octicon-link"></span>客户端</h3><p>客户端是用户操作HDFS最常用的方式，HDFS在部署时都提供了客户端。</p>
<p>HDFS客户端是一个库，暴露了HDFS文件系统接口，这些接口隐藏了HDFS实现中的大部分复杂性。</p>
<p>严格来说，客户端并不算是HDFS的一部分。</p>
<p>客户端可以支持打开、读取、写入等常见的操作，并且提供了类似Shell的命令行方式来访问HDFS中的数据。</p>
<p>此外，HDFS也提供了Java API，作为应用程序访问文件系统的客户端编程接口。</p>
<h3 id="h3-u5C40u9650u6027"><a name="局限性" class="reference-link"></a><span class="header-link octicon octicon-link"></span>局限性</h3><p>HDFS只设置唯一一个名称节点，这样做虽然大大简化了系统设计，但也带来了一些明显的局限性，具体如下：</p>
<p>（1）命名空间的限制：名称节点是保存在内存中的，因此，名称节点能够容纳的对象（文件、块）的个数会受到内存空间大小的限制。</p>
<p>（2）性能的瓶颈：整个分布式文件系统的吞吐量，受限于单个名称节点的吞吐量。</p>
<p>（3）隔离问题：由于集群中只有一个名称节点，只有一个命名空间，因此，无法对不同应用程序进行隔离。</p>
<p>（4）集群的可用性：一旦这个唯一的名称节点发生故障，会导致整个集群变得不可用。</p>
<h2 id="h2-u5B58u50A8u539Fu7406"><a name="存储原理" class="reference-link"></a><span class="header-link octicon octicon-link"></span>存储原理</h2><h3 id="h3-u5197u4F59u6570u636Eu4FDDu5B58"><a name="冗余数据保存" class="reference-link"></a><span class="header-link octicon octicon-link"></span>冗余数据保存</h3><p>多副本冗余存储</p>
<p>（1）加快数据传输速度</p>
<p>（2）容易检查数据错误</p>
<p>（3）保证数据可靠性</p>
<p><img src="http://39.103.184.190:8888/JancoBlog/static/image/2021-05/20210506-21592010000.png" alt=""></p>
<h3 id="h3-u6570u636Eu5B58u53D6u7B56u7565"><a name="数据存取策略" class="reference-link"></a><span class="header-link octicon octicon-link"></span>数据存取策略</h3><p>第一个副本：放置在上传文件的数据节点；如果是集群外提交，则随机挑选一台磁盘不太满、CPU不太忙的节点；</p>
<p>第二个副本：放置在与第一个副本不同的机架的节点上；</p>
<p>第三个副本：与第一个副本相同机架的其他节点上；</p>
<p>更多副本：随机节点。</p>
<p><img src="http://39.103.184.190:8888/JancoBlog/static/image/2021-05/20210506-21592610000.png" alt=""></p>
<p>数据读取：</p>
<p>HDFS提供了一个API可以确定一个数据节点所属的机架ID，客户端也可以调用API获取自己所属的机架ID；</p>
<p>当客户端读取数据时，从名称节点获得数据块不同副本的存放位置列表，列表中包含了副本所在的数据节点，可以调用API来确定客户端和这些数据节点所属的机架ID，当发现某个数据块副本对应的机架ID和客户端对应的机架ID相同时，就优先选择该副本读取数据，如果没有发现，就随机选择一个副本读取数据。</p>
<p>数据复制：</p>
<p>HDFS采用流水线复制的策略。</p>
<p>HDFS将文件写入本地，分成多个块。每个块都向名称节点发起请求，得到数据节点列表。连接第一个节点，写入；请求连接第二节点，写入……</p>
<h3 id="h3-u6570u636Eu9519u8BEFu4E0Eu6062u590D"><a name="数据错误与恢复" class="reference-link"></a><span class="header-link octicon octicon-link"></span>数据错误与恢复</h3><p>HDFS具有较高的容错性，可以兼容廉价的硬件，它把硬件出错看作一种常态，并设计了相应的机制检测数据错误和进行自动恢复，主要包括以下几种情形：名称节点出错、数据节点出错和数据出错。</p>
<ol>
<li><p>名称节点出错。</p>
<ul>
<li>名称节点保存了所有的元数据信息，其中，最核心的两大数据结构是FsImage和Editlog，如果这两个文件发生损坏，那么整个HDFS实例将失效。</li><li>HDFS设置了备份机制，<strong>把这些核心文件同步复制到备份服务器SecondaryNameNode上</strong>。当名称节点出错时，就可以根据备份服务器SecondaryNameNode中的FsImage和Editlog数据进行恢复。</li></ul>
</li><li><p>数据节点出错</p>
<ul>
<li>每个数据节点会定期向名称节点发送“心跳”信息，向名称节点报告自己的状态；当数据节点发生故障，或者网络发生断网时，名称节点就无法收到来自一些数据节点的心跳信息，这时，这些数据节点就会被标记为“宕机”，节点上面的所有数据都会被标记为“不可读”，名称节点不会再给它们发送任何I/O请求；这时，有可能出现一种情形，即由于一些数据节点的不可用，会导致一些数据块的副本数量小于冗余因子；</li><li>名称节点会定期检查这种情况，一旦发现某个数据块的副本数量小于冗余因子，就会启动数据冗余复制，为它生成新的副本；</li><li>HDFS和其它分布式文件系统的最大区别就是<strong>可以调整冗余数据的位置</strong>。</li></ul>
</li><li><p>数据出错</p>
<ul>
<li>网络传输和磁盘错误等因素，都会造成数据错误；客户端在读取到数据后，会采用md5和sha1对数据块进行校验，以确定读取到正确的数据；</li><li>当客户端读取文件的时候，会先读取该信息文件，然后，利用该信息文件对每个读取的数据块进行校验，如果校验出错，客户端就会请求到另外一个数据节点读取该文件块，并且向名称节点报告这个文件块有错误，名称节点会定期检查并且重新复制这个块。</li><li>在文件被创建时，客户端会对每一个文件块进行信息摘录，并把这些信息写入到同一个路径的隐藏文件里面</li></ul>
</li></ol>
</div></div><div class="article-comment"><div class="comment-title">添加笔记</div> <hr><div class="comment-list"></div><div class="add-comment"><textarea maxlength="20" placeholder="昵称" id="edit-comment-author" rows="1" cols="110"></textarea><textarea maxlength="50" placeholder="邮箱" id="edit-comment-email" rows="1" cols="110"></textarea><textarea maxlength="1000" placeholder="笔记" id="edit-comment-content" rows="5" cols="110"></textarea><button class="add-comment-btn">添加</button></div></div></body></html>