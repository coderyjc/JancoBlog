<!DOCTYPE html><html><head><meta charset="utf-8"><title>Ajax技术</title>    <link rel="stylesheet" href="../js/editor.md/css/editormd.min.css">   <script src="../js/jquery-1.12.js" type="text/javascript" charset="utf-8"></script>
   <script src="../js/article-preload.js" type="text/javascript" charset="utf-8"></script>
<link rel="stylesheet" href="../css/article.css"></head><body><!-- 导航条 --><div class="nav">    <!-- 回主页的"图标" -->    <a href="../../index.jsp" class="back-to-index">JancoBlog</a></div><!-- 所属分类 --><div class="article-sort"></div><!-- 标题栏 --><h1 class="article-title">Ajax技术</h1><!-- 作者栏 --><div class="article-info"><div class="article-author">作者：Jancoyan</div><div class="article-submit-time">发布时间：2021-05-06 21:27:21</div><div class="article-view-time"></div></div><div class="article-content"><div class="markdown-body editormd-preview-container" previewcontainer="true" style="padding: 20px;"><h1 id="h1-ajax"><a name="Ajax" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Ajax</h1><blockquote>
<p>实际开发中使用JQuery + Ajax较多，这部分内容作为了解即可。  </p>
<p>重点内容是 JQuery的 【## JQuery + Ajax 中的普通查询和级联查询】</p>
</blockquote>
<p>ajax:Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）。</p>
<ul>
<li><p>Asynchronous: 异步的意思</p>
</li><li><p>JavaScript：javascript脚本，在浏览器中执行</p>
</li><li><p>and : 和</p>
</li><li><p>xml : 是一种数据格式</p>
</li></ul>
<p>ajax是一种做局部刷新的新方法（2003左右），不是一种语言。 ajax包含的技术主要有javascript, dom,css, xml等等。 核心是javascript 和 xml （json）。</p>
<p>javascript：负责创建异步对象， 发送请求， 更新页面的dom对象。 ajax请求需要服务器端的数据。</p>
<p>xml，现在是json</p>
<h2 id="h2-u5168u5C40u5237u65B0u548Cu5C40u90E8u5237u65B0"><a name="全局刷新和局部刷新" class="reference-link"></a><span class="header-link octicon octicon-link"></span>全局刷新和局部刷新</h2><p>全局刷新： 整个浏览器被新的数据覆盖。 在网络中传输大量的数据。 浏览器需要加载，渲染页面。</p>
<p>局部刷新： 在浏览器器的内部，发起请求，获取数据，改变页面中的部分内容。 其余的页面无需加载和渲染。 网络中数据传输量少， 给用户的感受好。</p>
<p> ajax是用来做局部刷新的。局部刷新使用的核心对象是 异步对象（XMLHttpRequest）， 这个异步对象是存在浏览器内存中的 ，使用javascript语法创建和使用XMLHttpRequest对象。</p>
<h2 id="h2-u5F02u6B65u8BF7u6C42u5BF9u8C61"><a name="异步请求对象" class="reference-link"></a><span class="header-link octicon octicon-link"></span>异步请求对象</h2><p>步骤：</p>
<ol>
<li><p>创建异步对象 var xmlHttp = new XMLHttpRequest();</p>
</li><li><p>给异步对象绑定事件。onreadystatechange ：当异步对象发起请求，获取了数据都会触发这个事件。这个事件需要指定一个函数， 在函数中处理状态的变化。</p>
</li></ol>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="com">// 例如：</span></code></li><li class="L1"><code class="lang-java"><span class="pln">    xmlHttp</span><span class="pun">.</span><span class="pln">onreadystatechange</span><span class="pun">=</span><span class="pln"> function</span><span class="pun">(){</span></code></li><li class="L2"><code class="lang-java"><span class="pln">       </span><span class="pun">处理请求的状态变化。</span></code></li><li class="L3"><code class="lang-java"><span class="pln">         </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">xmlHttp</span><span class="pun">.</span><span class="pln">readyState </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> xmlHttp</span><span class="pun">.</span><span class="pln">status</span><span class="pun">==</span><span class="pln"> </span><span class="lit">200</span><span class="pln"> </span><span class="pun">){</span></code></li><li class="L4"><code class="lang-java"><span class="pln">           </span><span class="com">//可以处理服务器端的数据，更新当前页面</span></code></li><li class="L5"><code class="lang-java"><span class="pln">              var data </span><span class="pun">=</span><span class="pln"> xmlHttp</span><span class="pun">.</span><span class="pln">responseText</span><span class="pun">;</span></code></li><li class="L6"><code class="lang-java"><span class="pln">              document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">).</span><span class="pln">value</span><span class="pun">=</span><span class="pln"> data</span><span class="pun">;</span></code></li><li class="L7"><code class="lang-java"><span class="pln">         </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-java"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>
<ol>
<li><p>初始异步请求对象 : 异步的方法open(). <code>xmlHttp.open(请求方式get|post, "服务器端的访问地址", 同步|异步请求（默认是true，异步请求）)</code>例如：xmlHttp.open(“get”, “loginServlet?name=zs&amp;pwd=123”,true);</p>
</li><li><p>使用异步对象发送请求     <code>xmlHttp.send()</code></p>
</li></ol>
<p>异步对象的属性 readyState 表示异步对象请求的状态变化</p>
<ul>
<li>0：创建异步对象时， new XMLHttpRequest();</li><li>1: 初始异步请求对象， xmlHttp.open()</li><li>2：发送请求， xmlHttp.send()</li><li>3: 从服务器端获取了数据，此时3， 注意3是异步对象内部使用， 获取了原始的数据。</li><li>4：异步对象把接收的数据处理完成后。 此时开发人员在4的时候处理数据。在4的时候，开发人员做什么 ？  更新当前页面。</li></ul>
<p>异步对象的status属性，表示网络请求的状况的，  200， 404， 500， 需要是当status==200时，表示网络请求是成功的。</p>
<p>获取服务器端返回的数据， 使用异步对象的属性 responseText . <code>例子：xmlHttp.responseText</code></p>
<p>回调：当请求的状态变化时，异步对象会自动调用onreadystatechange事件对应的函数。</p>
<p>访问地址： 使用get方式传递参数<code>http://localhost:8080/course_myajax/bmiPrint?name=李四&amp;w=82&amp;h=1.8</code></p>
<p>前端实现：</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-html"><span class="pln">  </span><span class="tag">&lt;head&gt;</span></code></li><li class="L1"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;title&gt;</span><span class="pln">UpAndDown</span><span class="tag">&lt;/title&gt;</span></code></li><li class="L2"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="tag">&gt;</span></code></li><li class="L3"><code class="lang-html"></code></li><li class="L4"><code class="lang-html"><span class="pln">      </span><span class="kwd">function</span><span class="pln"> doAjax</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-html"><span class="pln">        </span><span class="com">// 使用内存中的一部对象，代替浏览器发起请求，异步对象使用js创建和管理。</span></code></li><li class="L6"><code class="lang-html"><span class="pln">        </span><span class="com">// 1. 创建对象异步对象</span></code></li><li class="L7"><code class="lang-html"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> xmlHttp </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMLHttpRequest</span><span class="pun">();</span></code></li><li class="L8"><code class="lang-html"><span class="pln">        </span><span class="com">// 2. 绑定事件</span></code></li><li class="L9"><code class="lang-html"><span class="pln">        xmlHttp</span><span class="pun">.</span><span class="pln">onreadystatechange </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="lang-html"><span class="pln">          </span><span class="com">//处理服务器返回的数据，更新当前的页面</span></code></li><li class="L1"><code class="lang-html"><span class="pln">          </span><span class="com">// 响应成功, 更新部分页面</span></code></li><li class="L2"><code class="lang-html"><span class="pln">          </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">xmlHttp</span><span class="pun">.</span><span class="pln">readyState </span><span class="pun">===</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> xmlHttp</span><span class="pun">.</span><span class="pln">status </span><span class="pun">===</span><span class="pln"> </span><span class="lit">200</span><span class="pun">){</span></code></li><li class="L3"><code class="lang-html"><span class="pln">            document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"result"</span><span class="pun">).</span><span class="pln">innerText </span><span class="pun">=</span><span class="pln"> xmlHttp</span><span class="pun">.</span><span class="pln">responseText</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-html"><span class="pln">          </span><span class="pun">}</span></code></li><li class="L5"><code class="lang-html"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L6"><code class="lang-html"><span class="pln">        </span><span class="com">// 3. 初始请求数据</span></code></li><li class="L7"><code class="lang-html"><span class="pln">        </span><span class="com">// 获取dom对象的value属性值</span></code></li><li class="L8"><code class="lang-html"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> height </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"height"</span><span class="pun">).</span><span class="pln">value</span><span class="pun">;</span></code></li><li class="L9"><code class="lang-html"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> weight </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">).</span><span class="pln">value</span><span class="pun">;</span></code></li><li class="L0"><code class="lang-html"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> param </span><span class="pun">=</span><span class="pln"> </span><span class="str">"weight="</span><span class="pun">+</span><span class="pln">weight</span><span class="pun">+</span><span class="str">"&amp;height="</span><span class="pun">+</span><span class="pln">height</span><span class="pun">;</span></code></li><li class="L1"><code class="lang-html"></code></li><li class="L2"><code class="lang-html"><span class="pln">        alert</span><span class="pun">(</span><span class="pln">param</span><span class="pun">);</span></code></li><li class="L3"><code class="lang-html"></code></li><li class="L4"><code class="lang-html"><span class="pln">        xmlHttp</span><span class="pun">.</span><span class="pln">open</span><span class="pun">(</span><span class="str">"get"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"result?"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> param</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span></code></li><li class="L5"><code class="lang-html"><span class="pln">        </span><span class="com">// 4. 发起请求</span></code></li><li class="L6"><code class="lang-html"><span class="pln">        xmlHttp</span><span class="pun">.</span><span class="pln">send</span><span class="pun">();</span></code></li><li class="L7"><code class="lang-html"><span class="pln">      </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-html"></code></li><li class="L9"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;/script&gt;</span></code></li><li class="L0"><code class="lang-html"><span class="pln">  </span><span class="tag">&lt;/head&gt;</span></code></li><li class="L1"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;body&gt;</span></code></li><li class="L2"><code class="lang-html"><span class="pln">        身高</span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"height"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li><li class="L3"><code class="lang-html"><span class="pln">        体重</span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"weight"</span><span class="tag">/&gt;</span></code></li><li class="L4"><code class="lang-html"><span class="pln">        </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"button"</span><span class="pln">  </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"submit"</span><span class="pln"> </span><span class="atn">onclick</span><span class="pun">=</span><span class="atv">"</span><span class="pln">doAjax</span><span class="pun">()</span><span class="atv">"</span><span class="tag">/&gt;</span></code></li><li class="L5"><code class="lang-html"><span class="pln">        </span><span class="tag">&lt;br&gt;</span></code></li><li class="L6"><code class="lang-html"><span class="pln">        </span><span class="tag">&lt;br&gt;</span></code></li><li class="L7"><code class="lang-html"><span class="pln">        </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"result"</span><span class="tag">&gt;</span><span class="pln">结果</span><span class="tag">&lt;/div&gt;</span></code></li><li class="L8"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;/body&gt;</span></code></li></ol></pre>
<p>后端实现：</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ResultServlet</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">HttpServlet</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"><span class="pln">    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doPost</span><span class="pun">(</span><span class="typ">HttpServletRequest</span><span class="pln"> request</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HttpServletResponse</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">ServletException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-java"><span class="pln">        request</span><span class="pun">.</span><span class="pln">setCharacterEncoding</span><span class="pun">(</span><span class="str">"utf-8"</span><span class="pun">);</span></code></li><li class="L3"><code class="lang-java"><span class="pln">        </span><span class="kwd">double</span><span class="pln"> height </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">.</span><span class="pln">parseDouble</span><span class="pun">(</span><span class="pln">request</span><span class="pun">.</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">"height"</span><span class="pun">));</span></code></li><li class="L4"><code class="lang-java"><span class="pln">        </span><span class="kwd">double</span><span class="pln"> weight </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">.</span><span class="pln">parseDouble</span><span class="pun">(</span><span class="pln">request</span><span class="pun">.</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">));</span></code></li><li class="L5"><code class="lang-java"><span class="pln">        </span><span class="kwd">double</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> weight </span><span class="pun">/</span><span class="pln"> </span><span class="pun">(</span><span class="pln">height </span><span class="pun">*</span><span class="pln"> height</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-java"><span class="pln">        </span><span class="com">//---------------------</span></code></li><li class="L7"><code class="lang-java"><span class="pln">        response</span><span class="pun">.</span><span class="pln">setContentType</span><span class="pun">(</span><span class="str">"text/html; charset=utf-8"</span><span class="pun">);</span></code></li><li class="L8"><code class="lang-java"><span class="pln">        </span><span class="typ">PrintWriter</span><span class="pln"> pw </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">getWriter</span><span class="pun">();</span></code></li><li class="L9"><code class="lang-java"><span class="pln">        pw</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"您的BMI指数为 ： "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">result</span><span class="pun">);</span></code></li><li class="L0"><code class="lang-java"><span class="pln">        pw</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span></code></li><li class="L1"><code class="lang-java"><span class="pln">        pw</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span></code></li><li class="L2"><code class="lang-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code class="lang-java"></code></li><li class="L4"><code class="lang-java"><span class="pln">    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doGet</span><span class="pun">(</span><span class="typ">HttpServletRequest</span><span class="pln"> request</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HttpServletResponse</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">ServletException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-java"><span class="pln">        doPost</span><span class="pun">(</span><span class="pln">request</span><span class="pun">,</span><span class="pln"> response</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code class="lang-java"><span class="pun">}</span></code></li></ol></pre>
<hr>
<p>全局刷新源代码：<code>Learning\JavaWeb\Ajax\BMI-整体刷新</code></p>
<p>局部刷新源代码：<code>Learning\JavaWeb\Ajax\BMI-局部刷新</code></p>
<h2 id="h2-json-"><a name="json的使用" class="reference-link"></a><span class="header-link octicon octicon-link"></span>json的使用</h2><p>ajax发起请求———-servlet（返回的一个json格式的字符串 { name:”河北”, jiancheng:”冀”,”shenghui”:”石家庄”}）</p>
<p>json分类：</p>
<ol>
<li>json对象 ，JSONObject ,这种对象的格式   名称:值， 也可以看做是 key:value 格式。</li><li>json数组， JSONArray, 基本格式  [{ name:”河北”, jiancheng:”冀”,”shenghui”:”石家庄”} , { name:”山西”, jiancheng:”晋”,”shenghui”:”太原”} ]</li></ol>
<p>为什么要使用json</p>
<ol>
<li>json格式好理解</li><li>json格式数据在多种语言中，比较容易处理。 使用java， javascript读写json格式的数据比较容易。</li><li>json格式数据他占用的空间下，在网络中传输快， 用户的体验好。</li></ol>
<p>处理json的工具库： gson（google）； fastjson（阿里），jackson， json-lib</p>
<p>在js中的，可以把json格式的字符串，转为json对象， json中的key，就是json对象的属性名。</p>
<p>添加处理json的jar包：</p>
<p>jackson-annotations-2.9.0.jar<br>jackson-core-2.9.0.jar<br>jackson-databind-2.9.0.jar</p>
<p>代码：</p>
<p>详细代码见:<code>Learning\JavaWeb\Ajax\使用json+ajax</code></p>
<p>前端</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="tag">&gt;</span></code></li><li class="L1"><code class="lang-html"></code></li><li class="L2"><code class="lang-html"><span class="pln">      </span><span class="kwd">function</span><span class="pln"> doAjax</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="lang-html"><span class="pln">        </span><span class="com">// 使用内存中的一部对象，代替浏览器发起请求，异步对象使用js创建和管理。</span></code></li><li class="L4"><code class="lang-html"><span class="pln">        </span><span class="com">// 1. 创建对象异步对象</span></code></li><li class="L5"><code class="lang-html"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> xmlHttp </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMLHttpRequest</span><span class="pun">();</span></code></li><li class="L6"><code class="lang-html"><span class="pln">        </span><span class="com">// 2. 绑定事件</span></code></li><li class="L7"><code class="lang-html"><span class="pln">        xmlHttp</span><span class="pun">.</span><span class="pln">onreadystatechange </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="lang-html"><span class="pln">          </span><span class="com">//处理服务器返回的数据，更新当前的页面</span></code></li><li class="L9"><code class="lang-html"><span class="pln">          </span><span class="com">// 响应成功</span></code></li><li class="L0"><code class="lang-html"><span class="pln">          </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">xmlHttp</span><span class="pun">.</span><span class="pln">readyState </span><span class="pun">===</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> xmlHttp</span><span class="pun">.</span><span class="pln">status </span><span class="pun">===</span><span class="pln"> </span><span class="lit">200</span><span class="pun">){</span></code></li><li class="L1"><code class="lang-html"><span class="pln">              </span><span class="com">// eval 是执行括号中的代码，把json转换为json对象</span></code></li><li class="L2"><code class="lang-html"><span class="pln">              </span><span class="kwd">var</span><span class="pln"> jsonobj </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">eval</span><span class="pun">(</span><span class="str">"("</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> xmlHttp</span><span class="pun">.</span><span class="pln">responseText </span><span class="pun">+</span><span class="pln"> </span><span class="str">")"</span><span class="pun">);</span></code></li><li class="L3"><code class="lang-html"><span class="pln">              </span><span class="com">// 更新json对象</span></code></li><li class="L4"><code class="lang-html"><span class="pln">              document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">).</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> jsonobj</span><span class="pun">.</span><span class="pln">name</span><span class="pun">;</span></code></li><li class="L5"><code class="lang-html"><span class="pln">              document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"jiancheng"</span><span class="pun">).</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> jsonobj</span><span class="pun">.</span><span class="pln">jiancheng</span><span class="pun">;</span></code></li><li class="L6"><code class="lang-html"><span class="pln">          </span><span class="pun">}</span></code></li><li class="L7"><code class="lang-html"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-html"><span class="pln">        </span><span class="com">// 3. 初始请求数据</span></code></li><li class="L9"><code class="lang-html"><span class="pln">        </span><span class="com">// 获取dom对象的value属性值</span></code></li><li class="L0"><code class="lang-html"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"id"</span><span class="pun">).</span><span class="pln">value</span><span class="pun">;</span></code></li><li class="L1"><code class="lang-html"><span class="pln">        xmlHttp</span><span class="pun">.</span><span class="pln">open</span><span class="pun">(</span><span class="str">"get"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"result?id="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-html"><span class="pln">        </span><span class="com">// 4. 发起请求</span></code></li><li class="L3"><code class="lang-html"><span class="pln">        xmlHttp</span><span class="pun">.</span><span class="pln">send</span><span class="pun">();</span></code></li><li class="L4"><code class="lang-html"><span class="pln">      </span><span class="pun">}</span></code></li><li class="L5"><code class="lang-html"></code></li><li class="L6"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;/script&gt;</span></code></li></ol></pre>
<p>后端</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="pln">    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doPost</span><span class="pun">(</span><span class="typ">HttpServletRequest</span><span class="pln"> request</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HttpServletResponse</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">ServletException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"><span class="pln">        request</span><span class="pun">.</span><span class="pln">setCharacterEncoding</span><span class="pun">(</span><span class="str">"utf-8"</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-java"><span class="pln">        </span><span class="typ">String</span><span class="pln"> sql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"select id, name, jiancheng, shenghui from province where id = ?"</span><span class="pun">;</span></code></li><li class="L3"><code class="lang-java"><span class="pln">        </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> params </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">request</span><span class="pun">.</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">"id"</span><span class="pun">)};</span></code></li><li class="L4"><code class="lang-java"><span class="pln">        </span><span class="typ">ResultSet</span><span class="pln"> rs </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DBUtil</span><span class="pun">.</span><span class="pln">executeQuery</span><span class="pun">(</span><span class="pln">sql</span><span class="pun">,</span><span class="pln"> params</span><span class="pun">);</span></code></li><li class="L5"><code class="lang-java"></code></li><li class="L6"><code class="lang-java"><span class="pln">        </span><span class="typ">Province</span><span class="pln"> province</span><span class="pun">;</span></code></li><li class="L7"><code class="lang-java"><span class="pln">        </span><span class="com">// 设置初始值。保证无论如何都会返回一个json格式的数据</span></code></li><li class="L8"><code class="lang-java"><span class="pln">        </span><span class="typ">String</span><span class="pln"> json </span><span class="pun">=</span><span class="pln"> </span><span class="str">"{}"</span><span class="pun">;</span></code></li><li class="L9"><code class="lang-java"></code></li><li class="L0"><code class="lang-java"><span class="pln">        </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"><span class="pln">            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">rs</span><span class="pun">.</span><span class="pln">next</span><span class="pun">()){</span></code></li><li class="L2"><code class="lang-java"><span class="pln">                province </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Province</span><span class="pun">(</span><span class="pln">rs</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="str">"id"</span><span class="pun">),</span></code></li><li class="L3"><code class="lang-java"><span class="pln">                        rs</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">),</span></code></li><li class="L4"><code class="lang-java"><span class="pln">                        rs</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="str">"jiancheng"</span><span class="pun">),</span></code></li><li class="L5"><code class="lang-java"><span class="pln">                        rs</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="str">"shenghui"</span><span class="pun">));</span></code></li><li class="L6"><code class="lang-java"><span class="pln">                </span><span class="typ">ObjectMapper</span><span class="pln"> objectMapper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectMapper</span><span class="pun">();</span></code></li><li class="L7"><code class="lang-java"><span class="pln">                json </span><span class="pun">=</span><span class="pln"> objectMapper</span><span class="pun">.</span><span class="pln">writeValueAsString</span><span class="pun">(</span><span class="pln">province</span><span class="pun">);</span></code></li><li class="L8"><code class="lang-java"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L9"><code class="lang-java"><span class="pln">        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">SQLException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="lang-java"><span class="pln">            e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span></code></li><li class="L1"><code class="lang-java"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L2"><code class="lang-java"><span class="pln">        response</span><span class="pun">.</span><span class="pln">setContentType</span><span class="pun">(</span><span class="str">"application/json;charset=utf-8"</span><span class="pun">);</span></code></li><li class="L3"><code class="lang-java"><span class="pln">        </span><span class="typ">PrintWriter</span><span class="pln"> pw </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">getWriter</span><span class="pun">();</span></code></li><li class="L4"><code class="lang-java"><span class="pln">        pw</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">json</span><span class="pun">);</span></code></li><li class="L5"><code class="lang-java"><span class="pln">        pw</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span></code></li><li class="L6"><code class="lang-java"><span class="pln">        pw</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span></code></li><li class="L7"><code class="lang-java"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>
<h2 id="h2-u5176u4ED6"><a name="其他" class="reference-link"></a><span class="header-link octicon octicon-link"></span>其他</h2><h3 id="h3-ajax-"><a name="ajax实现页面跳转" class="reference-link"></a><span class="header-link octicon octicon-link"></span>ajax实现页面跳转</h3><pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-javascript"><span class="pln">$</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">({</span></code></li><li class="L1"><code class="lang-javascript"><span class="pln">    type</span><span class="pun">:</span><span class="str">"POST"</span><span class="pun">,</span></code></li><li class="L2"><code class="lang-javascript"><span class="pln">    url</span><span class="pun">:</span><span class="pln"> </span><span class="com">//你的请求程序页面随便啦</span></code></li><li class="L3"><code class="lang-javascript"><span class="pln">    async</span><span class="pun">:</span><span class="kwd">false</span><span class="pun">,</span><span class="com">//同步：意思是当有返回值以后才会进行后面的js程序。</span></code></li><li class="L4"><code class="lang-javascript"><span class="pln">    data</span><span class="pun">:</span><span class="com">//请求需要发送的处理数据</span></code></li><li class="L5"><code class="lang-javascript"><span class="pln">    success</span><span class="pun">:</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">){</span></code></li><li class="L6"><code class="lang-javascript"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">msg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="com">//根据返回值进行跳转</span></code></li><li class="L7"><code class="lang-javascript"><span class="pln">            window</span><span class="pun">.</span><span class="pln">location</span><span class="pun">.</span><span class="pln">href </span><span class="pun">=</span><span class="pln"> </span><span class="str">'你的跳转的目标地址'</span><span class="pun">;</span></code></li><li class="L8"><code class="lang-javascript"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L9"><code class="lang-javascript"><span class="pln">    </span><span class="pun">});</span></code></li></ol></pre>
<p>ajax只接受最后返回的值，不会响应跳转请求更改浏览器地址栏地址转向的，你需要用js判断ajax的返回值是否要跳转，然后设置location.href实现跳转。</p>
<p>ajax异步请求struts的action只会返回所请求页面的html源代码。这样请求是不会跳转的。</p>
<p>补充一下:在springMVC框架中,当controller层方法返回String类型的时候默认是进行页面跳转,这时候后台使用return时ajax接收到的并不是后台返回的某个字符串或状态码,而是整个html对象,这时可以在后台的方法上添加注解 <a href="https://github.com/ResponseBody" title="@ResponseBody" class="at-link">@ResponseBody</a>,就可以直接使用return返回想要返回的字符串而不进行页面跳转,而且ajax接收到的也是我们想要返回的字符串而不是整个html对象,然后再进行判断后用window.location.href进行页面跳转</p>
</div></div><div class="article-comment"><div class="comment-title">添加笔记</div> <hr><div class="comment-list"></div><div class="add-comment"><textarea maxlength="20" placeholder="昵称" id="edit-comment-author" rows="1" cols="110"></textarea><textarea maxlength="50" placeholder="邮箱" id="edit-comment-email" rows="1" cols="110"></textarea><textarea maxlength="1000" placeholder="笔记" id="edit-comment-content" rows="5" cols="110"></textarea><button class="add-comment-btn">添加</button></div></div></body></html>