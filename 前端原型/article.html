<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Ajax技术</title>
		<link rel="stylesheet" href="./js/editor.md/css/editormd.min.css">
		<link rel="stylesheet" type="text/css" href="./css/article.css"/>
		<script src="./js/jquery-1.12.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/article-preload.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<!-- 导航条 -->
		<div class="nav">
		    <!-- 回主页的"图标" -->
		    <a href="#" class="back-to-index">JancoBlog</a>
		</div>
		
		<!-- 所属分类 -->
		<!-- 这个分类标签是提前写死在网页里的，把相关的js写在另一个文件中-->
		<div class="article-sort">
			<a href="">首页</a> > 
			<a href="">JavaWeb</a> > 
			<a href="">Maven</a>
		</div>
		<!-- 标题栏 -->
		<h1 class="article-title">Ajax技术</h1>
		<!-- 作者栏 -->
		<div class="article-info">
			<div class="article-author">作者：我自己</div>
			<div class="article-submit-time">发布时间：2021-1-1 00:23:36</div>
			<div class="article-view-time">浏览量：9954</div>
		</div>
		<!-- 正文 -->
		<div class="article-content">
			<div class="markdown-body editormd-preview-container" previewcontainer="true" style="padding: 20px;"><h1 id="h1-ajax"><a name="Ajax" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Ajax</h1><blockquote>
			<p>实际开发中使用JQuery + Ajax较多，这部分内容作为了解即可。  </p>
			<p>重点内容是 JQuery的 【## JQuery + Ajax 中的普通查询和级联查询】</p>
			</blockquote>
			<p>ajax:Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）。</p>
			<ul>
			<li><p>Asynchronous: 异步的意思</p>
			</li><li><p>JavaScript：javascript脚本，在浏览器中执行</p>
			</li><li><p>and : 和</p>
			</li><li><p>xml : 是一种数据格式</p>
			</li></ul>
			<p>ajax是一种做局部刷新的新方法（2003左右），不是一种语言。 ajax包含的技术主要有javascript, dom,css, xml等等。 核心是javascript 和 xml （json）。</p>
			<p>javascript：负责创建异步对象， 发送请求， 更新页面的dom对象。 ajax请求需要服务器端的数据。</p>
			<p>xml，现在是json</p>
			<h2 id="h2-u5168u5C40u5237u65B0u548Cu5C40u90E8u5237u65B0"><a name="全局刷新和局部刷新" class="reference-link"></a><span class="header-link octicon octicon-link"></span>全局刷新和局部刷新</h2><p>全局刷新： 整个浏览器被新的数据覆盖。 在网络中传输大量的数据。 浏览器需要加载，渲染页面。</p>
			<p>局部刷新： 在浏览器器的内部，发起请求，获取数据，改变页面中的部分内容。 其余的页面无需加载和渲染。 网络中数据传输量少， 给用户的感受好。</p>
			<p> ajax是用来做局部刷新的。局部刷新使用的核心对象是 异步对象（XMLHttpRequest）， 这个异步对象是存在浏览器内存中的 ，使用javascript语法创建和使用XMLHttpRequest对象。</p>
			<h2 id="h2-u5F02u6B65u8BF7u6C42u5BF9u8C61"><a name="异步请求对象" class="reference-link"></a><span class="header-link octicon octicon-link"></span>异步请求对象</h2><p>步骤：</p>
			<ol>
			<li><p>创建异步对象 var xmlHttp = new XMLHttpRequest();</p>
			</li><li><p>给异步对象绑定事件。onreadystatechange ：当异步对象发起请求，获取了数据都会触发这个事件。这个事件需要指定一个函数， 在函数中处理状态的变化。</p>
			</li></ol>
			<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="com">// 例如：</span></code></li><li class="L1"><code class="lang-java"><span class="pln">    xmlHttp</span><span class="pun">.</span><span class="pln">onreadystatechange</span><span class="pun">=</span><span class="pln"> function</span><span class="pun">(){</span></code></li><li class="L2"><code class="lang-java"><span class="pln">       </span><span class="pun">处理请求的状态变化。</span></code></li><li class="L3"><code class="lang-java"><span class="pln">         </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">xmlHttp</span><span class="pun">.</span><span class="pln">readyState </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> xmlHttp</span><span class="pun">.</span><span class="pln">status</span><span class="pun">==</span><span class="pln"> </span><span class="lit">200</span><span class="pln"> </span><span class="pun">){</span></code></li><li class="L4"><code class="lang-java"><span class="pln">           </span><span class="com">//可以处理服务器端的数据，更新当前页面</span></code></li><li class="L5"><code class="lang-java"><span class="pln">              var data </span><span class="pun">=</span><span class="pln"> xmlHttp</span><span class="pun">.</span><span class="pln">responseText</span><span class="pun">;</span></code></li><li class="L6"><code class="lang-java"><span class="pln">              document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">).</span><span class="pln">value</span><span class="pun">=</span><span class="pln"> data</span><span class="pun">;</span></code></li><li class="L7"><code class="lang-java"><span class="pln">         </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-java"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>
			<ol>
			<li><p>初始异步请求对象 : 异步的方法open(). <code>xmlHttp.open(请求方式get|post, "服务器端的访问地址", 同步|异步请求（默认是true，异步请求）)</code>例如：xmlHttp.open(“get”, “loginServlet?name=zs&amp;pwd=123”,true);</p>
			</li><li><p>使用异步对象发送请求     <code>xmlHttp.send()</code></p>
			</li></ol>
			<p>异步对象的属性 readyState 表示异步对象请求的状态变化</p>
			<ul>
			<li>0：创建异步对象时， new XMLHttpRequest();</li><li>1: 初始异步请求对象， xmlHttp.open()</li><li>2：发送请求， xmlHttp.send()</li><li>3: 从服务器端获取了数据，此时3， 注意3是异步对象内部使用， 获取了原始的数据。</li><li>4：异步对象把接收的数据处理完成后。 此时开发人员在4的时候处理数据。在4的时候，开发人员做什么 ？  更新当前页面。</li></ul>
			<p>异步对象的status属性，表示网络请求的状况的，  200， 404， 500， 需要是当status==200时，表示网络请求是成功的。</p>
			<p>获取服务器端返回的数据， 使用异步对象的属性 responseText . <code>例子：xmlHttp.responseText</code></p>
			<p>回调：当请求的状态变化时，异步对象会自动调用onreadystatechange事件对应的函数。</p>
			<p>访问地址： 使用get方式传递参数<code>http://localhost:8080/course_myajax/bmiPrint?name=李四&amp;w=82&amp;h=1.8</code></p>
			<p>前端实现：</p>
			<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-html"><span class="pln">  </span><span class="tag">&lt;head&gt;</span></code></li><li class="L1"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;title&gt;</span><span class="pln">UpAndDown</span><span class="tag">&lt;/title&gt;</span></code></li><li class="L2"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/javascript"</span><span class="tag">&gt;</span></code></li><li class="L3"><code class="lang-html"></code></li><li class="L4"><code class="lang-html"><span class="pln">      </span><span class="kwd">function</span><span class="pln"> doAjax</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-html"><span class="pln">        </span><span class="com">// 使用内存中的一部对象，代替浏览器发起请求，异步对象使用js创建和管理。</span></code></li><li class="L6"><code class="lang-html"><span class="pln">        </span><span class="com">// 1. 创建对象异步对象</span></code></li><li class="L7"><code class="lang-html"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> xmlHttp </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMLHttpRequest</span><span class="pun">();</span></code></li><li class="L8"><code class="lang-html"><span class="pln">        </span><span class="com">// 2. 绑定事件</span></code></li><li class="L9"><code class="lang-html"><span class="pln">        xmlHttp</span><span class="pun">.</span><span class="pln">onreadystatechange </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="lang-html"><span class="pln">          </span><span class="com">//处理服务器返回的数据，更新当前的页面</span></code></li><li class="L1"><code class="lang-html"><span class="pln">          </span><span class="com">// 响应成功, 更新部分页面</span></code></li><li class="L2"><code class="lang-html"><span class="pln">          </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">xmlHttp</span><span class="pun">.</span><span class="pln">readyState </span><span class="pun">===</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> xmlHttp</span><span class="pun">.</span><span class="pln">status </span><span class="pun">===</span><span class="pln"> </span><span class="lit">200</span><span class="pun">){</span></code></li><li class="L3"><code class="lang-html"><span class="pln">            document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"result"</span><span class="pun">).</span><span class="pln">innerText </span><span class="pun">=</span><span class="pln"> xmlHttp</span><span class="pun">.</span><span class="pln">responseText</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-html"><span class="pln">          </span><span class="pun">}</span></code></li><li class="L5"><code class="lang-html"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L6"><code class="lang-html"><span class="pln">        </span><span class="com">// 3. 初始请求数据</span></code></li><li class="L7"><code class="lang-html"><span class="pln">        </span><span class="com">// 获取dom对象的value属性值</span></code></li><li class="L8"><code class="lang-html"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> height </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"height"</span><span class="pun">).</span><span class="pln">value</span><span class="pun">;</span></code></li><li class="L9"><code class="lang-html"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> weight </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">).</span><span class="pln">value</span><span class="pun">;</span></code></li><li class="L0"><code class="lang-html"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> param </span><span class="pun">=</span><span class="pln"> </span><span class="str">"weight="</span><span class="pun">+</span><span class="pln">weight</span><span class="pun">+</span><span class="str">"&amp;height="</span><span class="pun">+</span><span class="pln">height</span><span class="pun">;</span></code></li><li class="L1"><code class="lang-html"></code></li><li class="L2"><code class="lang-html"><span class="pln">        alert</span><span class="pun">(</span><span class="pln">param</span><span class="pun">);</span></code></li><li class="L3"><code class="lang-html"></code></li><li class="L4"><code class="lang-html"><span class="pln">        xmlHttp</span><span class="pun">.</span><span class="pln">open</span><span class="pun">(</span><span class="str">"get"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"result?"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> param</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span></code></li><li class="L5"><code class="lang-html"><span class="pln">        </span><span class="com">// 4. 发起请求</span></code></li><li class="L6"><code class="lang-html"><span class="pln">        xmlHttp</span><span class="pun">.</span><span class="pln">send</span><span class="pun">();</span></code></li><li class="L7"><code class="lang-html"><span class="pln">      </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-html"></code></li><li class="L9"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;/script&gt;</span></code></li><li class="L0"><code class="lang-html"><span class="pln">  </span><span class="tag">&lt;/head&gt;</span></code></li><li class="L1"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;body&gt;</span></code></li><li class="L2"><code class="lang-html"><span class="pln">        身高</span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"height"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li><li class="L3"><code class="lang-html"><span class="pln">        体重</span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"weight"</span><span class="tag">/&gt;</span></code></li><li class="L4"><code class="lang-html"><span class="pln">        </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"button"</span><span class="pln">  </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"submit"</span><span class="pln"> </span><span class="atn">onclick</span><span class="pun">=</span><span class="atv">"</span><span class="pln">doAjax</span><span class="pun">()</span><span class="atv">"</span><span class="tag">/&gt;</span></code></li><li class="L5"><code class="lang-html"><span class="pln">        </span><span class="tag">&lt;br&gt;</span></code></li><li class="L6"><code class="lang-html"><span class="pln">        </span><span class="tag">&lt;br&gt;</span></code></li><li class="L7"><code class="lang-html"><span class="pln">        </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"result"</span><span class="tag">&gt;</span><span class="pln">结果</span><span class="tag">&lt;/div&gt;</span></code></li><li class="L8"><code class="lang-html"><span class="pln">    </span><span class="tag">&lt;/body&gt;</span></code></li></ol></pre>
			<p>后端实现：</p>
			<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ResultServlet</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">HttpServlet</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-java"><span class="pln">    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doPost</span><span class="pun">(</span><span class="typ">HttpServletRequest</span><span class="pln"> request</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HttpServletResponse</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">ServletException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-java"><span class="pln">        request</span><span class="pun">.</span><span class="pln">setCharacterEncoding</span><span class="pun">(</span><span class="str">"utf-8"</span><span class="pun">);</span></code></li><li class="L3"><code class="lang-java"><span class="pln">        </span><span class="kwd">double</span><span class="pln"> height </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">.</span><span class="pln">parseDouble</span><span class="pun">(</span><span class="pln">request</span><span class="pun">.</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">"height"</span><span class="pun">));</span></code></li><li class="L4"><code class="lang-java"><span class="pln">        </span><span class="kwd">double</span><span class="pln"> weight </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">.</span><span class="pln">parseDouble</span><span class="pun">(</span><span class="pln">request</span><span class="pun">.</span><span class="pln">getParameter</span><span class="pun">(</span><span class="str">"weight"</span><span class="pun">));</span></code></li><li class="L5"><code class="lang-java"><span class="pln">        </span><span class="kwd">double</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> weight </span><span class="pun">/</span><span class="pln"> </span><span class="pun">(</span><span class="pln">height </span><span class="pun">*</span><span class="pln"> height</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-java"><span class="pln">        </span><span class="com">//---------------------</span></code></li><li class="L7"><code class="lang-java"><span class="pln">        response</span><span class="pun">.</span><span class="pln">setContentType</span><span class="pun">(</span><span class="str">"text/html; charset=utf-8"</span><span class="pun">);</span></code></li><li class="L8"><code class="lang-java"><span class="pln">        </span><span class="typ">PrintWriter</span><span class="pln"> pw </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">getWriter</span><span class="pun">();</span></code></li><li class="L9"><code class="lang-java"><span class="pln">        pw</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"您的BMI指数为 ： "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">result</span><span class="pun">);</span></code></li><li class="L0"><code class="lang-java"><span class="pln">        pw</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">();</span></code></li><li class="L1"><code class="lang-java"><span class="pln">        pw</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span></code></li><li class="L2"><code class="lang-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code class="lang-java"></code></li><li class="L4"><code class="lang-java"><span class="pln">    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doGet</span><span class="pun">(</span><span class="typ">HttpServletRequest</span><span class="pln"> request</span><span class="pun">,</span><span class="pln"> </span><span class="typ">HttpServletResponse</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">ServletException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-java"><span class="pln">        doPost</span><span class="pun">(</span><span class="pln">request</span><span class="pun">,</span><span class="pln"> response</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code class="lang-java"><span class="pun">}</span></code></li></ol></pre>
			<hr>
			<p>全局刷新源代码：<code>Learning\JavaWeb\Ajax\BMI-整体刷新</code></p>
			<p>局部刷新源代码：<code>Learning\JavaWeb\Ajax\BMI-局部刷新</code></p>
			</div>
		</div>
		
		<div class="article-comment">
			
		</div>
		
		<!-- 页脚 -->
		<footer>
			<ul>
			    <li><a href="#">关于</a></li>
			</ul>
		</footer>
	</body>
</html>
